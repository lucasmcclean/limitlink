<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LimitL.ink</title>
    <link rel="icon" href="/static/img/favicon.ico" sizes="any" />
    <link rel="icon" href="/static/img/favicon.svg" type="image/svg+xml" />
    <link href="/static/css/tailwind.css" rel="stylesheet" />
    <script defer src="/static/js/htmx.min.js"></script>
    <script defer src="/static/js/alpine.min.js"></script>
  </head>

  <body>
    <header class="h-screen w-9/10 mx-auto flex items-center justify-evenly">
      <div class="w-fit flex flex-col justify-center gap-4">
        <h1
          class="text-6xl sm:text-7xl md:text-8xl font-display font-extrabold tracking-normal"
        >
          LimitL<span class="opacity-60">.</span>ink
        </h1>
        <h2 class="text-xl sm:text-2xl">Create expiring links in seconds!</h2>
        <div class="flex gap-4 text-lg sm:text-xl font-bold">
          <a
            href="/about"
            class="relative group w-fit px-4 py-2 rounded-xl border border-surface overflow-hidden transition-colors duration-300 hover:border-accent"
          >
            <div
              class="absolute inset-0 bg-surface group-hover:opacity-0 transition-opacity duration-300"
            ></div>
            <span class="relative z-10 text-text">Learn More</span>
          </a>
          <a
            href="#new-link"
            class="relative group w-fit px-4 py-2 rounded-xl border border-surface overflow-hidden transition-colors duration-300 hover:border-accent"
          >
            <div
              class="absolute inset-0 bg-gradient-to-r from-accent to-secondary group-hover:opacity-0 transition-opacity duration-300"
            ></div>
            <span class="relative z-10 text-text">Get Started</span>
          </a>
        </div>
      </div>
      <div class="hidden sm:block h-fit w-1/4">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          viewBox="0 0 63.43792 63.601873"
          class="h-auto w-full hover:scale-105 transition-transform"
          aria-hidden="true"
        >
          <defs>
            <linearGradient id="a">
              <stop offset="0" stop-color="var(--color-stop-1, #ec4067)" />
              <stop offset="1" stop-color="var(--color-stop-2, #a01a7d)" />
            </linearGradient>
            <linearGradient
              xlink:href="#a"
              id="b"
              x1="51.758202"
              x2="80.53347"
              y1="83.43824"
              y2="70.020103"
              gradientUnits="userSpaceOnUse"
            />
          </defs>
          <path
            fill="var(--fill-color, #f8f8f8)"
            d="M24.736715 23.232806c1.5175 5.663388 7.298497 9.001043 12.961882 7.483544l17.88975-4.793544c5.663383-1.517499 9.001063-7.298494 7.483553-12.961881l-1.36959-5.111361c-1.517498-5.663387-7.2985-9.001042-12.961882-7.483543L35.070542 4.028856c.347536.173027.683871.367711 1.010276.577799l.000631.000359c.000332.00017.000961.000561.0012.000707l.000634.000369.000634.000368.000631.000359c.101785.06559.1961.141704.295615.210761l.000634.000368.000499-.000133.000132.000492c.02939.02039.05787.04206.08655.06346.05139.03644.10129.07483.152061.112269.132903.09788.270198.189256.398539.293387.116412.09445.225462.1973.337928.296791l.000631.000359c.00023.000208.000542.000621.000758.000832.179055.158426.356501.318742.524935.489569l.000633.000368.000135.000503c.112702.114336.218943.234649.326609.354382.000259.000293.000519.000617.000758.000833.000515.000576.000952.00078.0015.0017.08046.08954.155947.183977.233912.275983.02904.03466.05803.06924.08761.103316.04018.04918.08356.09521.122903.145219.04801.06105.103405.114798.150142.176981l10.960466-2.936849c3.539614-.948436 7.152739 1.137598 8.101176 4.677214l1.369585 5.111361c.948437 3.539616-1.137603 7.152737-4.677217 8.101173l-17.889688 4.793528c-3.539615.948437-7.152739-1.137598-8.101176-4.677214l-.619256-2.311093-.750329-2.800267-.0056-.02096-.679175-2.534715-3.833518 1.027188.679175 2.534715.0056.02096.750329 2.800267z"
          />
          <path
            fill="var(--fill-color, #f8f8f8)"
            d="M38.701204 14.012697c-1.517501-5.663391-7.298499-9.001047-12.961882-7.483548L7.849571 11.322693c-5.663383 1.517499-9.00105 7.298494-7.483549 12.961885l1.369582 5.111351c1.5175 5.663387 7.298502 9.001042 12.961885 7.483543l13.669885-3.662835c-.347535-.173027-.683871-.36771-1.010276-.577799l-.000631-.000359c-.000332-.00017-.000961-.00056-.0012-.000707l-.000632-.000359-.000633-.000369-.000635-.000368c-.101785-.06559-.1961-.141704-.295613-.210751l-.000634-.000368-.000499.000133-.000135-.000502c-.02939-.02039-.05787-.04206-.08655-.06346-.05139-.03644-.101289-.07484-.15206-.11227-.132901-.09787-.270197-.189256-.398539-.293387-.116412-.09445-.225462-.197299-.337925-.296782l-.000631-.000358c-.000231-.000208-.000541-.000621-.000758-.000832-.179055-.158426-.356498-.318733-.524935-.489569l-.000631-.000359-.000135-.000502c-.112702-.114336-.218942-.234649-.326608-.354383-.00026-.000293-.00052-.000616-.000759-.000832-.000513-.000566-.000952-.00078-.0015-.0017-.08046-.08953-.155949-.183987-.233912-.275983-.02904-.03467-.05803-.06924-.08761-.103317-.04018-.04918-.08356-.09521-.122903-.145218-.04798-.06096-.103405-.114798-.150142-.176981L13.670415 33.04613c-3.539615.948437-7.15274-1.137597-8.101177-4.677213l-1.369585-5.111361c-.948438-3.53962 1.137602-7.152741 4.677217-8.101178l17.889689-4.793527c3.539615-.948437 7.152738 1.137598 8.101176 4.677217l.619256 2.311094.750329 2.800267.0056.02096.679173 2.534705 3.833518-1.027188-.679172-2.534705-.0056-.02096-.750329-2.800267z"
          />
          <path
            fill="url(#b)"
            d="M63.499999 52.916666c-5.86317 0-10.583333 4.720164-10.583333 10.583334v7.0559c0 .565553.04404 1.120347.128674 1.661397-1.724512 1.881474-2.774507 4.392529-2.774507 7.157702v10.583334c0 5.86316 4.720166 10.583337 10.583333 10.583337h10.583333c5.863167 0 10.583333-4.720177 10.583333-10.583337V79.374999c0-2.765167-1.050001-5.276229-2.774507-7.157702.08463-.541065.128674-1.095853.128674-1.661397V63.5c0-5.86317-4.720173-10.583334-10.583333-10.583334zm-.4408 3.96875h6.173267c3.66447 0 6.614583 2.950104 6.614583 6.614584v6.24458c-1.341044-.612256-2.83403-.952914-4.40955-.952914H60.854166c-1.575518 0-3.068507.340659-4.40955.952914V63.5c0-3.66448 2.950103-6.614584 6.614583-6.614584zm3.086634 18.281055a6.1736114 6.1736289 0 0 1 6.173783 6.173266 6.1736114 6.1736289 0 0 1-3.08715 5.346444v4.710823c0 1.53457-1.235277 2.769857-2.769857 2.769857h-.633553c-1.534568 0-2.769857-1.235287-2.769857-2.769857v-4.710823a6.1736114 6.1736289 0 0 1-3.08715-5.346444 6.1736114 6.1736289 0 0 1 6.173784-6.173266z"
            transform="translate(-34.42687 -36.939803)"
          />
          <path
            fill="var(--fill-color, #f8f8f8)"
            d="M28.367359 33.216465c-.347536-.173027-.683869-.3677-1.010274-.577789l-.000633-.000369c-.000332-.00017-.001-.000581-.0012-.000707l-.000634-.000369-.000633-.000368-.000634-.000369c-.101785-.06559-.196101-.141704-.295613-.210751l-.000634-.000368-.000499.000133-.000132-.000492c-.02939-.02039-.05787-.04208-.08656-.06348-.05139-.03644-.10129-.07483-.152061-.112269-.1329-.09787-.270194-.189247-.398536-.293378-.116412-.09445-.225463-.197309-.337927-.296791l-.000634-.000369-.000634-.000368c-.179055-.158425-.356497-.318732-.524932-.489559l-.000758-.000832-.000132-.000493c-.112702-.114336-.218813-.234166-.326479-.353899l-.000759-.000833c-.000256-.000283-.000669-.0012-.000912-.0014l-.000634-.000369c-.08047-.08954-.155947-.183977-.23391-.275973-.02904-.03467-.05803-.06924-.08761-.103317-.04018-.04918-.08356-.09521-.122903-.145218-.04798-.06096-.103405-.114798-.150142-.176981l-10.960467 2.936848c-1.690532.452977-3.397921.213419-4.82368-.545735l-4.736991 1.269273c2.575881 2.84665 6.610877 4.175071 10.587724 3.109478zm9.797527-6.733807-1.493475.400175c-3.539615.948437-7.152739-1.137601-8.101177-4.677216l-.619255-2.311093-.750329-2.800265-.0056-.02096-.679175-2.534714-3.833518 1.027188.679175 2.534714.0056.02096.750329 2.800265.619255 2.311093c1.5175 5.663387 7.298499 9.001046 12.961883 7.483546l1.493475-.400175z"
          />
        </svg>
      </div>
    </header>

    <main>
      <section
        id="new-link"
        class="w-full mb-32 flex flex-col justify-center items-center"
      >
        <form
          x-data="linkForm()"
          @submit.prevent="validateAndSubmit"
          hx-post="/links"
          hx-target="#new-link"
          hx-swap="innerHTML"
          class="w-full max-w-2xl p-8 flex flex-col gap-4"
          aria-labelledby="form-heading"
        >
          <h3 id="form-heading" class="text-3xl font-bold text-text">
            Create a New Link
          </h3>

          <!-- Error Placeholder -->
          <div
            id="form-error"
            tabindex="-1"
            class="hidden text-error"
            role="alert"
            aria-live="polite"
          ></div>

          <!-- Target URL -->
          <div>
            <label for="target" class="block text-lg mb-1">Target URL:</label>
            <input
              type="url"
              id="target"
              name="target"
              placeholder="https://example.com"
              :class="errors.target ? 'border-error' : 'border-text'"
              class="w-full px-4 py-2 border rounded-lg"
              required
              :aria-invalid="!!errors.target"
              :aria-describedby="errors.target ? 'target-error' : null"
            />
            <p
              id="target-error"
              x-show="errors.target"
              x-cloak
              class="font-semibold mt-1"
              role="alert"
            >
              <span aria-hidden="true">⚠</span>
              <span x-text="errors.target"></span>
            </p>
          </div>

          <!-- Expiry Selection -->
          <div>
            <label for="expires-in" class="block text-lg mb-1"
              >Expires In:</label
            >
            <select
              id="expires-in"
              name="expires-in"
              x-model="expiry"
              class="w-full px-4 py-2 border border-text rounded-lg"
            >
              <option value="1">1 day</option>
              <option value="7" selected>7 days</option>
              <option value="30">30 days</option>
              <option value="custom">Custom date/time</option>
            </select>
          </div>

          <!-- Custom Expiry -->
          <div
            id="expires-custom-container"
            x-show="expiry === 'custom'"
            x-cloak
            :aria-hidden="expiry !== 'custom'"
          >
            <label for="expires-at-display" class="block text-lg mb-1"
              >Custom Expiry:</label
            >
            <input
              type="datetime-local"
              id="expires-at-display"
              name="expires-at-display"
              :class="errors.expiresAt ? 'border-error' : 'border-text'"
              class="w-full px-4 py-2 border rounded-lg"
              :aria-invalid="!!errors.expiresAt"
              :aria-describedby="errors.expiresAt ? 'expires-at-error' : null"
            />
            <p
              id="expires-at-error"
              x-show="errors.expiresAt"
              x-cloak
              class="font-semibold mt-1"
              role="alert"
            >
              <span aria-hidden="true">⚠</span>
              <span x-text="errors.expiresAt"></span>
            </p>

            <input type="hidden" id="expires-at" name="expires-at" disabled />
          </div>

          <!-- Advanced Options Toggle -->
          <div>
            <button
              type="button"
              id="toggle-advanced"
              @click="showAdvanced = !showAdvanced"
              class="text-accent hover:underline"
              :aria-expanded="showAdvanced.toString()"
              aria-controls="advanced-options"
            >
              <template x-if="showAdvanced"
                ><p>Hide Advanced Options</p></template
              >
              <template x-if="!showAdvanced"
                ><p>Show Advanced Options</p></template
              >
            </button>
          </div>

          <!-- Advanced Options -->
          <div
            id="advanced-options"
            x-show="showAdvanced"
            x-cloak
            class="flex flex-col gap-4"
            :aria-hidden="!showAdvanced"
          >
            <!-- Max Hits -->
            <div>
              <label for="max-hits" class="block text-lg mb-1">
                Max Hits
                <span class="font-semibold opacity-60">(optional)</span>:
              </label>
              <input
                type="number"
                id="max-hits"
                name="max-hits"
                min="1"
                placeholder="Unlimited"
                :class="errors.maxHits ? 'border-error' : 'border-text'"
                class="w-full px-4 py-2 border rounded-lg"
                :aria-invalid="!!errors.maxHits"
                :aria-describedby="errors.maxHits ? 'max-hits-error' : null"
              />
              <p
                id="max-hits-error"
                x-show="errors.maxHits"
                x-cloak
                class="font-semibold mt-1"
                role="alert"
              >
                <span aria-hidden="true">⚠</span>
                <span x-text="errors.maxHits"></span>
              </p>
            </div>

            <!-- Valid From -->
            <div>
              <label for="valid-from-display" class="block text-lg mb-1">
                Valid From
                <span class="font-semibold opacity-60">(optional)</span>:
              </label>
              <input
                type="datetime-local"
                id="valid-from-display"
                name="valid-from-display"
                :class="errors.validFrom ? 'border-error' : 'border-text'"
                class="w-full px-4 py-2 border rounded-lg"
                :aria-invalid="!!errors.validFrom"
                :aria-describedby="errors.validFrom ? 'valid-from-error' : null"
              />
              <p
                id="valid-from-error"
                x-show="errors.validFrom"
                x-cloak
                class="font-semibold mt-1"
                role="alert"
              >
                <span aria-hidden="true">⚠</span>
                <span x-text="errors.validFrom"></span>
              </p>

              <input type="hidden" id="valid-from" name="valid-from" disabled />
            </div>

            <!-- Password -->
            <div>
              <label for="password" class="block text-lg mb-1">
                Password
                <span class="font-semibold opacity-60">(optional)</span>:
              </label>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Leave blank for none"
                class="w-full px-4 py-2 border border-text rounded-lg"
              />
            </div>

            <!-- Slug Length -->
            <div>
              <label for="slug-length" class="block text-lg mb-1">
                Slug Length
                <span class="font-semibold opacity-60">(default: 7)</span>:
              </label>
              <input
                type="number"
                id="slug-length"
                name="slug-length"
                min="6"
                max="12"
                placeholder="7"
                :class="errors.slugLength ? 'border-error' : 'border-text'"
                class="w-full px-4 py-2 border rounded-lg"
                :aria-invalid="!!errors.slugLength"
                :aria-describedby="errors.slugLength ? 'slug-length-error' : null"
              />
              <p
                id="slug-length-error"
                x-show="errors.slugLength"
                x-cloak
                class="font-semibold mt-1"
                role="alert"
              >
                <span aria-hidden="true">⚠</span>
                <span x-text="errors.slugLength"></span>
              </p>
            </div>

            <!-- Slug Charset -->
            <div>
              <label for="slug-charset" class="block text-lg text-text mb-1">
                Slug Charset
                <span class="font-semibold opacity-60"
                  >(default: alphanumeric)</span
                >:
              </label>
              <select
                id="slug-charset"
                name="slug-charset"
                class="w-full px-4 py-2 border border-text rounded-lg"
              >
                <option value="alphanumeric" selected>Alphanumeric</option>
                <option value="letters">Letters</option>
                <option value="numbers">Numbers</option>
              </select>
            </div>
          </div>

          <div>
            <button
              type="submit"
              class="w-full bg-accent my-4 py-2 px-6 text-text rounded-xl hover:bg-opacity-80 transition-colors"
            >
              Create Link
            </button>
          </div>
        </form>
      </section>
    </main>

    <footer class="w-full px-8 sm:px-16 py-8 flex flex-wrap justify-between">
      <p class="opacity-70">
        &copy; 2025 Lucas McClean &mdash; LimitLink&trade;
      </p>

      <p class="font-display text-accent tracking-widest">//LM</p>
    </footer>
  </body>

  <script>
    document.body.addEventListener("htmx:responseError", (event) => {
      document.getElementById("form-error").classList.remove("hidden");
      document.getElementById("form-error").innerHTML =
        event.detail.xhr.responseText;
      document.getElementById("form-error").focus();
    });

    function linkForm() {
      return {
        errors: {},
        expiry: "7",
        showAdvanced: false,

        validateAndSubmit(event) {
          this.errors = {};

          const getVal = (id) => document.getElementById(id)?.value?.trim();

          const target = getVal("target");
          if (!target) {
            this.errors.target = "Please enter a valid URL.";
          } else {
            try {
              new URL(target);
            } catch {
              this.errors.target = "Invalid URL format.";
            }
          }

          if (this.expiry === "custom") {
            const customDateStr = getVal("expires-at-display");
            if (!customDateStr) {
              this.errors.expiresAt = "Please enter a custom expiry date/time.";
            } else {
              const localDate = new Date(customDateStr);

              if (isNaN(localDate.getTime())) {
                this.errors.expiresAt = "Invalid date/time format.";
              } else {
                const now = new Date();
                if (localDate <= now) {
                  this.errors.expiresAt =
                    "Expiry date/time must be in the future.";
                } else {
                  const isoExpiry = localDate.toISOString();
                  const hiddenInput = document.getElementById("expires-at");
                  hiddenInput.value = isoExpiry;
                  hiddenInput.disabled = false;
                }
              }
            }
          } else {
            const hiddenInput = document.getElementById("expires-at");
            hiddenInput.value = "";
            hiddenInput.disabled = true;
          }

          const maxHits = getVal("max-hits");
          if (maxHits) {
            if (!/^\d+$/.test(maxHits) || parseInt(maxHits) < 1) {
              this.errors.maxHits = "Max Hits must be a positive integer.";
            }
          }

          const validFromStr = getVal("valid-from-display");
          if (validFromStr) {
            const localValidFrom = new Date(validFromStr);
            if (isNaN(localValidFrom.getTime())) {
              this.errors.validFrom = "Please provide a valid date/time.";
            } else if (!this.errors.expiresAt) {
              let expiresAtDate = new Date();
              if (this.expiry === "custom") {
                const customExpiryStr = getVal("expires-at-display");
                expiresAtDate = new Date(customExpiryStr);
              } else {
                expiresAtDate.setDate(
                  expiresAtDate.getDate() + parseInt(getVal("expires-in"), 10),
                );
              }
              const now = new Date();
              if (localValidFrom >= expiresAtDate) {
                this.errors.validFrom = "Valid From must be before expiration.";
              } else if (localValidFrom <= now) {
                this.errors.validFrom = "Valid From must be after now.";
              } else {
                const isoValidFrom = localValidFrom.toISOString();
                const hiddenInput = document.getElementById("valid-from");
                hiddenInput.value = isoValidFrom;
                hiddenInput.disabled = false;
              }
            }
          } else {
            const hiddenInput = document.getElementById("valid-from");
            hiddenInput.value = "";
            hiddenInput.disabled = true;
          }

          const slugLength = getVal("slug-length");
          if (slugLength) {
            const len = parseInt(slugLength);
            if (isNaN(len) || len < 6 || len > 12) {
              this.errors.slugLength = "Slug Length must be between 6 and 12.";
            }
          }

          if (Object.keys(this.errors).length > 0) {
            return;
          }

          document.getElementById("form-error").classList.add("hidden");
          htmx.trigger(event.target, "submit");
        },
      };
    }
  </script>
</html>
